承知いたしました。ご提示いただいた論文は、オントロジーアライメントシステムLogMapにLLMベースのOracleを統合し、不確実なマッピングの検証に限定的に使用する、費用対効果の高い手法を詳述しています。

しかしながら、**この研究で使用されたLLMは、OpenAIのGPT-4o MiniとGoogleのGemini Flashモデル（v1.5, 2.0, 2.0 Lite, 2.5 Preview）であり、AnthropicのClaudeモデルは評価対象に含まれていません**ので、この論文の内容をそのままClaude Codeで再現するための直接的な手順はソースには記載されていません。

もし、この研究の**目的と構造**を再現し、**Claudeモデル**を「LLMベースのOracle」として利用する場合の`instructions.md`を作成するのであれば、以下の要素と手順が必須となります。

---

# instructions.md: LLMオラクルを用いたオントロジーアライメント検証の再現

本プロジェクトは、大規模言語モデル（LLM）をオントロジーアライメントにおけるドメイン専門家の代替となる「Oracle」として活用し、特に既存のアライメントシステム（LogMap）が**不確実であると判断したマッピングのサブセット（$M_{ask}$）**の検証を行う、費用対効果の高い手法を再現することを目的としています。

## 1. 環境構築と依存関係

### 1.1 基礎システム（LogMapの代替）
本研究ではLogMapをベースシステムとして使用していますが、再現には同様の機能（語彙インデックス作成、探索空間削減、マッピングの選択と修復、そして**不確実なマッピング $M_{ask}$ の特定**）を持つオントロジーアライメントシステムが必要です。

*   **LogMap/代替システムの導入:**
    *   オントロジーアライメントシステムの実行環境をセットアップします。
    *   システムがオントロジーデータ（エンティティ、親クラス、類義語）を抽出できることを確認します。
*   **ソースコード:**
    *   この研究のソースコードと関連リソースはZenodoリポジトリおよびGitHubリポジトリ（`https://github. com/city-artificial-intelligence/rai-ukraine-kga-llm`）で公開されています。可能な限りこれを活用してください。

### 1.2 LLMクライアント（Claude Code）
LLMをOracleとして利用するため、Anthropic Claudeモデルにアクセスし、結果を構造化して受け取るためのPython環境を構築します。

*   **APIアクセス:** Claude APIキーを設定します。
*   **クライアント実装:** `Anthropic SDK`を使用し、LLM診断（LLM Diagnosis）モジュールを実装します。

## 2. 実験データセットの準備

*   **OAEIデータセットの取得:** 評価には、OAEIキャンペーンのアナトミー、ラージバイオ、バイオ-MLのデータセットから、計9つのマッチングタスクを使用します。
*   **オントロジーデータ抽出:** 各タスクの入力オントロジー（O1とO2）から、エンティティの語彙表現（ラベル）、類義語、コンテキスト情報（直接の親、または2レベルの親クラス）を抽出します。

## 3. LLMオラクルの実装

LLMオラクルは、LogMapによって不確実とされたマッピング $⟨e1, e2⟩ \in M_{ask}$ の正しさを評価し、`True`または`False`を返すエンジンです。

### 3.1 プロンプトビルダー（Prompt Builder）の設計

LLMへの問いかけ（プロンプト）は、オントロジー駆動型で設計する必要があります。この研究では、特に**PNLF$^S$** プロンプトが最良の結果（平均YI 0.550）を達成しました。Claude Codeでこの構造を再現します。

| プロンプトテンプレート | 特徴 | 抽出データ |
| :--- | :--- | :--- |
| **P** (基本) | 構造化、基本情報のみ | エンティティ名、直接の親クラス |
| **PNLF** (自然言語フレンドリー) | NLF (自然言語に近い表現) | エンティティ名、直接の親クラス |
| **PNLF$^S$** (最適モデル) | NLF + S (類義語を含む) | エンティティ名、類義語、直接の親クラス |
| **PNLF$^{EC+S}$** | NLF + EC (拡張コンテキスト) + S (類義語) | エンティティ名、類義語、2レベルの親クラス |

**【必須】構造化出力の強制:**
診断結果をバイナリ（True/False）分類として確実に得るため、Claude APIの**構造化出力機能**を利用し、応答が常にブーリアン値であることを保証します。これにより、応答の堅牢性が向上し、手動でのパースが不要になります。

**【任意】システムプロンプトの調整:**
LLMに「オントロジーマッチングの専門家」や「階層的および意味的コンテキストを重視する生体医学オントロジー専門家」としての役割を与えるシステムメッセージを試行し、その影響を分析します。

### 3.2 LLM診断（LLM Diagnosis）の実行

1.  LogMap（または代替システム）を実行し、**不確実なマッピングの集合 $M_{ask}$** を特定します。
2.  $M_{ask}$ に含まれる各マッピング $⟨e1, e2⟩$ に対し、ステップ3.1で構築したプロンプト（PNLF$^S$が推奨）を使用してClaude APIを呼び出します。
3.  LLMの応答（True/False）を取得し、Oracleの診断結果として記録します。
4.  レート制限（Rate limits）とコストを考慮し、API呼び出しを並行処理またはバッチ処理します。

## 4. 評価と分析

LLMベースのOracleをLogMapに統合した結果（$LogMap+OrLLM$）を、以下の指標で評価します。

### 4.1 診断能力の評価

LLMが $M_{ask}$ の正しさをどれだけ正確に診断できたかを評価します。

*   **Youden's Index (YI):** 感度（Sensitivity, Se）と特異度（Specificity, Sp）を用いて計算します（$YI = Se + Sp - 1$）。目標はYIを最大化することです（YI > 0.5が良好とされる）。

### 4.2 全体的な性能評価

LLMオラクル統合後のLogMapの全体的な性能を評価します。

*   **Fスコア（F-score）:** 精度（Precision, Pr）と再現率（Recall, Re）に基づいて計算します。
*   **比較対象:** LogMapの自動モード（LogMap auto）の結果と、エラー率が変動するシミュレートされたOracle（Or0, Or10, Or20, Or30）の結果と比較し、Claudeモデルが約20%のエラー率を持つ専門家（Or20）と同等の性能を発揮するかどうかを検証します。

## 5. 再現性の確保

*   **再現性:** LLMベースのシステムは信頼性が懸念されるため、複数の独立した実行（ラン）を行い、結果の標準偏差を記録して性能の変動が軽微であることを確認します。
*   **データリークの考慮:** 評価に使用するOAEIベンチマークが、Claudeモデルの事前学習データに含まれている可能性を考慮し、結果の解釈に注意します。

---

**メタファー:**

この実験は、既存の「優秀だが特定のパズル（マッピング）に戸惑う専門家（LogMap）」の隣に、「膨大な一般知識を持つ新しい協力者（LLMオラクル）」を配置するようなものです。LLMはすべての簡単なパズルを解くのではなく、LogMapが「これに自信がない」と差し出した**最も難しいパズルの小さな山（$M_{ask}$）**だけを担当します。これにより、全体的な解決スピード（Fスコア）が向上し、しかもコスト（LLM呼び出し回数）を抑えることができるのです。